START_POS_LOC	EQU	40H
END_POS_LOC	EQU	41H
VRAM_SIZE	EQU	08D
START_ADDR	EQU	30H
END_ADDR	EQU	37H

		ORG	00H
		SJMP	MAIN

		ORG	30H
MAIN:		MOV	START_POS_LOC, #START_ADDR
		MOV	END_POS_LOC, #END_ADDR
		ACALL	SCAN_ROW
HALT:		SJMP	MAIN
;===========================================================================
SCAN_ROW:	ACALL	GENERATE_SHAPE

		MOV	R0, START_POS_LOC
		MOV	P0, #00H
		MOV	P1, #00H
		MOV	A, #00000001B
		MOV	R2, #VRAM_SIZE			; R7 CHANGED TO R2

SCNLP:		MOV	P0, #00H
		MOV	P1, @R0
		MOV	P0, A
		RL	A
		INC	R0
		PUSH	A
		ACALL	CHCK_LIMIT
		POP	A
		DJNZ	R2, SCNLP			; R7 CHANGED TO R2

		PUSH	A
		ACALL	DOWN_1
		POP	A

		MOV	R2, #VRAM_SIZE			; R7 CHANGED TO R2
		SJMP	SCNLP

;===========================================================================
CHCK_LIMIT:	MOV	A, R0
		SUBB	A, #START_ADDR
		MOV	B, #VRAM_SIZE
		DIV	AB
		MOV	A, #START_ADDR
		ADD	A, B
		MOV	R0, A
		RET
;===========================================================================
DOWN_1:		DEC	START_POS_LOC
		MOV	A, START_POS_LOC
		CJNE	A, #START_ADDR, PR_END
		MOV	START_POS_LOC, #END_ADDR

PR_END:		DEC	END_POS_LOC
		MOV	A, END_POS_LOC
		CJNE	A, #START_ADDR, EXIT_DOWN
		MOV	END_POS_LOC, #END_ADDR

EXIT_DOWN:	MOV	R0, START_POS_LOC
		RET
;===========================================================================
GENERATE_SHAPE:	MOV	30H, #00001000B
		MOV	31H, #00011100B
		MOV	32H, #00000000B
		MOV	33H, #00000000B
		MOV	34H, #00000000B
		MOV	35H, #00000000B
		MOV	36H, #00000000B
		MOV	37H, #00000000B

		;MOV	30H,	#00001000B
		;MOV	31H,	#00001100B
		;MOV	32H,	#00001000B
		;MOV	33H,	#00000000B
		;MOV	34H,	#00000000B
		;MOV	35H,	#00000000B
		;MOV	36H,	#00000000B
		;MOV	37H,	#00000000B
		RET
		END
